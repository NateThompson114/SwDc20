@page "/"
@inject Blazored.LocalStorage.ILocalStorageService LocalStorage
@inject NavigationManager NavigationManager

<PageTitle>SwDc20</PageTitle>

<h1>Welcome to SwDc20</h1>

<h2 class="alert alert-info">THIS IS PRE ALPHA</h2>

<p>Please do not use this yet as your online storage, once 0.8 character sheet is ready I will remove the alpha banner and let everyone know. I have included a Purge Local Storage option if you find yourself unable to open your characters.</p>
<button class="btn btn-danger" @onclick="PurgeLocalStorage">Purge Local Storage</button>

@if (!string.IsNullOrEmpty(message))
{
    <div class="alert alert-info mt-3">
        @message
    </div>
}

@code {
    private string message;

    private async Task PurgeLocalStorage()
    {
        try
        {
            await LocalStorage.ClearAsync();
            message = "Local storage has been purged. The application will now refresh.";
            StateHasChanged();

            // Wait for a moment to allow the user to see the message
            await Task.Delay(2000);

            // Refresh the page to reset the application state
            NavigationManager.NavigateTo("/", forceLoad: true);
        }
        catch (Exception ex)
        {
            message = $"An error occurred while purging local storage: {ex.Message}";
        }
    }
}